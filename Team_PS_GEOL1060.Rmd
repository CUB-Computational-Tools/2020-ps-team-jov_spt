---
title: "Ocean Acidification Problem Set"
author: "Juliana Olsen-Valdez & Stephanie Plaza-Torres"
date: "Last knitted `r format(Sys.Date(), '%d %b %Y')`"
output:
  html_document: 
    df_print: paged
    number_sections: yes
    toc: yes
    toc_float: true
    toc_depth: 3
    code_folding: show
editor_options:
  chunk_output_type: inline
---

> Click into a code cell (the gray blocks below) to select or edit it. To run a selected code cell, hit `Ctrl`+`Shift`+`Enter` (Windows & Linux) / `Command`+`Shift`+`Enter` (MacOS). Make sure that each code cell runs successfully before you move on to the next one. There is also a small green 'play' button in the corner that wil run the code cell for you.

<p>&nbsp;</p>
# ***Ocean Acidification***
<p>&nbsp;</p>

## Introduction
Ocean acidification is one of the many impacts of climate change and increased atmospheric carbon dioxide ($CO_2$), and many modern studies have focused on changes in temperature or $CO_2$ on Earth over the last hundreds of years. However, scientists can also look to geologic records millions of years ago as a case study to understand what happened to ecosystems in the past that were also subject to large increases in atmospheric $CO_2$ and temperature. In this activity, we'll look at data sets from a time known as the Paleocene-Eocene Thermal Maximum (PETM) and compare those data sets to modern data to see how changes in temperature and $CO_2$ compare between the past and present. 

In this activity you'll also use and manipulate computer programming code in **R** to load data sets and make plots. All code will include comments (text that follows the # symbol) that explains what each line of code **says** and what each line of code **does**. Computer programming can be somewhat intimidating, but this activity will walk through all parts of the code along the way. 

## Learning Goals
By the end of this activity, you will be able to:
1) Understand the process of ocean acidification and how it's related to changes in atmospheric $CO_2$ and temperature. 
2) Interpret plots from PETM and modern data for temperature and/or atmospheric $CO_2$.
3) Edit code to upload a data file into R and change certain characteristics of data plots.
4) Gain a sense for the utility in using computer programming to investigate data sets and scientific problems.

## Prerequisites
Prior to completing this Problem Set, it is expected that students: 
- Have opened the Binder link on the Canvas page and let the link load so they will be ready to participate when the activity begins.
- Have completed the supplemental readings on Ocean Acidification from the Canvas page and heard the lecture from Dr. Crump or Prof. Miller. 


## Background and Defining Terms: 
### Ocean Acidification and Atmospheric Carbon Dioxide

**Ocean acidification** refers to the process by which *increasing levels of carbon dioxide* ($CO_2$) correlate to a *decrease in the pH of the ocean*. The Earth has a natural process by which it sequesters carbon dioxide (in rocks, for example) and releases carbon dioxide (through processes like decomposition). However, anthropogenic ("human-caused") behavior has resulted in an unnatural increase in the amount of carbon dioxide in the atmosphere, which also leads to higher levels of $CO_2$ in the oceans. 

As the supplemental readings explained, when levels of carbon dioxide increase in the atmosphere, the chemistry of the oceans change. That atmospheric carbon dioxide mixes with sea water to create carbonic acid. Increased  carbonic acid in the ocean makes the ocean more acidic and contributes to breaking down corals and organism's carbonate shells through a chain of chemical reactions. As more and more $CO_2$ is added into the atmopshere, this process continues to happen and more and more organisms and ecosystems can be negatively affected. 

In modern times, the increase in atmospheric carbon dioxide has come from the burning of fossil fuels (a lot of buried carbon), but there have been other times in the geologic past when large amounts of carbon dioxide were released into the atmosphere (and not by humans!)

### Paleocene-Eocene Thermal Maximum
The Paleocene-Eocene Thermal Maximum (PETM) is one of those times. The PETM happened around 55 million years ago (about 10 million years after a big meteorite impact made the dinosaurs go extinct). The PETM was first recognized after deep ocean bedrock cores recorded a big change in the carbon isotope values around this time (known as a Carbon Isotope Excursion or CIE) that are associated with the earth warming around 4-5°C (for perspective, modern warming since the industrial revolution has been around 1°C). Over time, scientists have concluded that this time period (over a few thousand years) experienced high levels of atmospheric carbon dioxide and increased temperatures in the ocean and on land (McInerney & Wing, 2011). Moreover, the PETM triggered mass extinctions of deep-sea organisms, showing that these drastic changes in carbon dioxide, pH, and temperatures could also impact the biosphere.

### Modern-Day Carbon Dioxide and Sea Surface Temperature (SST)
We're going to first investigate data sets that look at the level of carbon dioxide measured in the atmosphere (in parts per million) from the [Global Monitoring Laboratory in Mauna Loa](https://www.esrl.noaa.gov/gmd/ccgg/trends/monthly.html) over time. We'll also be looking at modern data sets for [Sea Surface Temperature (SST) from NOAA](https://www.ncdc.noaa.gov/data-access/marineocean-data/extended-reconstructed-sea-surface-temperature-ersst). 

## Using Data Sets 

> We'll first load some R packages that will allow us to make our code do things like pull in data sets from a folder or make a plot. *R packages* are collections of functions and data sets developed by the community. They improve the existing base fuctionalities of R and expand what you can achieve with your code. 
But what is a function?

> A *function* is a conjunction of code that achieves a specific task. This code can be 'called' using the function's given name. What the function ultimately does is take in data and return a result based on that function's 'inner' code. 

```{r load packages}
# The library() function loads each package. You need to do this so R can find the functions you need from a certain package. Once the package loads all the different functions associated with it are usable. 
library(tidyverse) #these are all different libraries that help the code do different things
library(readxl)#the blue "library" part tells R that this is a package it should load and the black writing is the name of the specific package(in this case "readxl" which helps us read Excel files into R)
library(cowplot)
library(ggplot2)#this library, for example, helps us make plots of our data. 

#notice that because there is a "#" symbol before all of the note text above, it's all just comments that don't affect the code!
```

### Modern $CO_2$ Concentration

At Mauna Loa, NOAA has data looking at the monthly avergae of the parts per million concentration of $CO_2$ since the 1980s. We will plot this data to see what the trends for $CO_2$ have been in the past 40 years.

First, let's import the Mauna Loa data:
```{r load Mauna Loa data}
MaunaLoa_data <-  read_excel("data/co2_monthly_average.xlsx") #here we are reading an excel file that contains our monthly average CO2 data (in ppm) from Mauna Loa. Since our data is in a table, the file will import itself as a data frame called MaunaLoa_data (this is a variable).
#a data frame in R is a table or a two-dimensional array-like structure in which each column contains values of one variable and each row contains one set of values from each column. 

MaunaLoa_data #this will print out our data frame for us to see and make sure it looks alright. You can see columns year, month, decimal, average, trend. 
#year tells us the year we are in 
#month tells the month of a particular year 
#decimal is the year with a decimal place that represents the month of that year in which you are
#average shows the monthly mean CO2 ppm values, centered on the middle of each month 
#trend represents the same as average, after correction for the average seasonal cycle


```

Next, let's have you assign a variable in a similar fashion in which we added the Excel data to `MaunaLoa_data`. In this next code chunk, write "parts per million (ppm)" after the `<-` arrow besides our ML_y_title variable. What we are doing here is setting up the y axis title for our plot for the Mauna Loa data.

```{r assign y axis title to a variable}
ML_y_title <- "parts per million (ppm)"
```

Congrats! You've assigned a variable. Now let's put it to use in our Mauna Loa plot.

We will use the decimal column for our x axis and the average column for our y. We are using decimal instead of the year or month column so we can see the progression of concentration data through each yea rand the next. 

*What do you think would happen if we use the year or month columns for our plot?*

Answer here: 

```{r plot Mauna Loa data}
ML_CO2vsYear <- #We create a new plot stored in "ML_CO2vsYear"
ggplot(MaunaLoa_data, aes(x = decimal, y = average)) + #we call the function ggplot to input our data set and assign x and y variables
geom_line(size = 0.5, color = 'black')+ #We define a black line to connect our data points
labs(y = ML_y_title, x = "Year", title = bquote("Atmospheric" ~ CO[2] ~ "at Mauna Loa Observatory")) + #We give our graph labels
theme_bw() #We make the background grid theme/color black and white 

ML_CO2vsYear #prints out our plot
```
We can see a general upwards trend in $CO_2$ concentration. This is due to anthropogenic influence in emissions. Since there is so much fossil fuel consumption, $CO_2$ has increased steadily through the years. In this [link](https://www.esrl.noaa.gov/gmd/ccgg/trends/ff.html) you will see and animation showing the contributions of fossil fuel consumption to atmospheric $CO_2$.

I imagine you have already noticed that the monthly average concentrations of our plot fluctuate up and down.

*Why do you think this causes this?*

Answer here: 


```{r plot Mauna Loa data with trend}
ML_CO2vsYear_wTrend <- #We create a new plot stored in "ML_CO2vsYear_wTrend"
ggplot() + #we call the function ggplot to input our data set and assign x and y variables
geom_line(data = MaunaLoa_data, aes(x = decimal, y = average), size = 0.5, color = 'black')+ #We define a black line to connect our data points 
geom_line(data = MaunaLoa_data, aes(x = decimal, y = trend), size = 0.5, color = 'red')+ #We add our trend column data in red 
labs(y = ML_y_title, x = "Year", title = bquote("Atmospheric" ~ CO[2] ~ "at Mauna Loa Observatory")) + #We give our graph labels
theme_bw() #We make the background grid theme/color black and white 

ML_CO2vsYear_wTrend #prints out our plot
```
If we plot the trend column from our `MaunaLoa_data` (seen here as the red line) we can see the monthly ppm average but corrected for the seasonal cycles (ups and downs) you noticed before.

### Modern Sea Surface Temperature

Now let's look at what has been happening to the sea surface temperature given the increasing $CO_2$ concentrations.

Remember that $CO_2$ is a greenhouse gas, which can trap the heat originated from the Earth’s surface.  If there is more $CO_2$ then more heat gets trapped, and if there is less $CO_2$ then less heat gets trapped.  This affects the average temperature of the planet, including seas surface temperature (SST).

Let's load our NOAA SST data and plot it.

```{r load modern SST data}
ModernSST_data <- read_excel("data/EPA_SST.xlsx") 
names(ModernSST_data) <- c("year", "anomaly", "lower_95", "higher_95")

fahr_to_cel <- function(temp) {
  cel <- (temp - 32) * (5 / 9)
  return(cel)
}

ModernSST_data$anomaly <- fahr_to_cel(ModernSST_data$anomaly)
ModernSST_data$lower_95 <- fahr_to_cel(ModernSST_data$lower_95)
ModernSST_data$higher_95 <- fahr_to_cel(ModernSST_data$higher_95)

```

```{r plot modern SST data}
SSTvsYear <-
ggplot(ModernSST_data, aes(x = year, y = anomaly)) + 
geom_line(size = 0.5, color = 'black') + 
geom_ribbon(aes(ymin = lower_95, ymax = higher_95), linetype = 2, alpha = 0.3) +
geom_hline(yintercept = -17.7778, linetype = "dashed", color = "maroon") +
labs(y = "Temperature Anomaly (degrees F) ", x = "Year", title = "Average Global Sea Surface Temperature, 1880–2015") + 
theme_bw()  

SSTvsYear #prints out our plot
```

In the graph above we have plotted the average surface temperature change (respect to a 1971 to 2000 average as baseline - shown as dahsed line) of the world’s oceans since 1880. Choosing a different baseline period would not change the shape of the data over time. The gray shade shows the uncertainty of the data, based on the methods used to get the average temperatures and the amount of measurements.

### Comparing the trends in $CO_2$ and SST

Now let's compare the trends our $CO_2$ and SST plots. 

```{r plot modern SST data since 1980}
new_ModernSST_data <- subset(ModernSST_data, year >= 1980)

newSSTvsYear <-
ggplot(new_ModernSST_data, aes(x = year, y = anomaly)) + 
geom_line(size = 0.5, color = 'black') + 
geom_ribbon(aes(ymin = lower_95, ymax = higher_95), linetype = 2, alpha = 0.3) +
geom_hline(yintercept = -17.7778, linetype = "dashed", color = "maroon") +
labs(y = "Temperature Anomaly (°F) ", x = "Year", title = "Average Global Sea Surface Temperature, 1980–2015") + 
theme_bw()  

```
```{r plot CO2 and SST side by side}
modern_sideBYside <- plot_grid(ML_CO2vsYear_wTrend, newSSTvsYear, ncol = 2, nrow = 1)

modern_sideBYside
```
<p>&nbsp;</p>
*Do you see a relationship between $CO_2$ and SST? If so, why?*

Answer here: 


### Investigating Paleocene-Eocene Thermal Maximum (PETM) carbon dioxide and pH values: 
Now that we've seen some data from modern values for $CO_2$ and pH, let's look at values estimated for during the PETM. We'll be looking at data from a paper by [Gutjhar et al. (2017)](https://www.nature.com/articles/nature23646#Sec12)

We'll first look at ${\delta}^{13}C$ (said "delta carbon 13") which reflects the amount or ratio (${\delta}$) of the heavy isotope (13) of the element Carbon (C). This value is recorded in rocks, meaning it can be preserved and measured to give insight into possible changes in atmospheric carbon dioxide levels from the past. However, ${\delta}^{13}C$ isn't directly equal to $CO_2$. In fact, it's the reverse: more positive values of ${\delta}^{13}C$ are associated with decreased levels of atmospheric $CO_2$ and  more negative values of ${\delta}^{13}C$ are associated with increased levels of atmospheric $CO_2$. Keeping this in mind, let's plot the ${\delta}^{13}C$ for the PETM and see what it looks like. 

Let's first load PETM data for ${\delta}^{13}C$. 
```{r load PETM d13C data}
PETM_d13C_data <- #we are making a new data set called "PETM_d13C_data" 
  read_excel("data/gutjhar_data_d13C.xlsx") #we are reading in the excel file with our data (which is in the data folder)
```

Plot the ${\delta}^{13}C$ data compared to age:
```{r plot PETM d13C data}
d13CvsAge <- #We create a new plot that's named "d13CvsAge"
ggplot(PETM_d13C_data, aes(x = Age, y = d13C)) + #we call the function ggplot to input our data set and assign x and y variables
geom_vline(xintercept = 0, linetype = "dashed", color = "maroon") + #this line of code plots the red dashed line at our 0 Age value
geom_line()+ #we define a black line to represent the data
labs(y=expression(delta^13*C~"(\u2030 PDB)"), x = "Age relative to CIE event (kyr)", title = expression(delta^13*C~"(\u2030, PDB) throughout the PETM from Gutjhar et al. (2017)" ))+ #We give our graph labels
theme_bw() #We make the background grid theme/color black and white 
d13CvsAge
```
<p>&nbsp;</p>
If you notice the axes of this plot, the y-axis is ${\delta}^{13}C$ and the x-axis is titled "Age relative to CIE event (kyr)". The x-axis represents the age (negative values) or after (positive values) the Carbon Isotope Excursion (CIE) event in thousands of years (kyr). The Carbon Isotope Excursion event just refers to the BIG CHANGE in the ${\delta}^{13}C$ values that are recorded in these rocks and is now a sort of signature that marks the PETM in rocks all over the world. So, this plot shows values of ${\delta}^{13}C$ relative to thousands of years before or after that CIE event (where the Age is equal to 0).

*About how many thousands of years does it take for the big Carbon Isotope Excursion (CIE) event to occur? Is this change ${\delta}^{13}C$ recording an increase or a decrease in the level of atmospheric carbon dioxide during this time?*

Answer here: 



Now we'll load and plot PETM data for estimated pH: 
```{r load PETM pH data}
PETM_pH_data <- #we are making a new data set called "PETM_pH_data" for the pH data set
  read_excel("data/gutjhar_data_pH.xlsx") #we are reading in the excel file with our data (which is in the data folder)
```

```{r plot PETM pH data}
pHvsAge <- #We create a new plot that's named "pHvsAge"
ggplot(PETM_pH_data, aes(x = Age, y = pH)) + #we call the function ggplot to input our data set and assign x and y variables
geom_vline(xintercept = 0, linetype = "dashed", color = "maroon") + #this line of code plots the red dashed line at our 0 Age value
geom_line(size = 0.5, color = 'black') + #we define a black line to represent the data
geom_ribbon(aes(ymin = SDmin, ymax = SDmax), linetype = 2, alpha = 0.3) + #this line of code adds the shaded error (max and min values) in the estimated pH values
labs(y = "pH", x = "Age relative to CIE event (kyr)", title = "Estimated pH throughout the PETM from Gutjhar et al. (2017) ")+ #we include axis labels and a title for the plot
theme_bw() #this makes the theme of the plot "black and white"

pHvsAge #prints out our plot
```

<p>&nbsp;</p>
Did you know that in modern times, the pH of the oceans have decreased by 0.1 on the pH scale. That may not seem like much, but pH is not a direct comparison to the change in how acidic the oceans get. So, a change in pH of 0.1 makes the oceans about 30% more acidic - yikes! 

*What is the estimated change in the pH for the PETM based on the plot above?*

Answer here: 


```{r PETM d13C vs pH}
PETM_d13CvspH <- plot_grid(d13CvsAge, pHvsAge, ncol = 2, nrow = 1) #here we're making a new plot with a special function called "plot_grid" that plots two existing plots next to each other
PETM_d13CvspH #prints out the plot
```
<p>&nbsp;</p>
*Do you see a relationship between ${\delta}^{13}C$ and pH? If so, why?* 

Answer here: 



*Based on the plots, how many thousands of years does it take for the values to return to what they were prior to the PETM (or CIE event)?*


Answer here: 



If we compare the PETM pH data with the modern pH data:
```{r PETM vs Modern SST}
PETM_vs_modern <- plot_grid(pHvsAge, pHvsYear, ncol = 2, nrow = 1)
PETM_vs_modern
```

## Sources: 

- McInerney, F. A., & Wing, S. L. (2011). The Paleocene-Eocene Thermal Maximum: a perturbation of carbon cycle, climate, and biosphere with implications for the future. Annual Review of Earth and Planetary Sciences, 39, 489-516.
- NOAA Global Monitoring Laboratory, Mauna Loa
- NOAA Extended Reconstructed Sea Surface Temperature (ERSST)
- PETM data modified from Stokke, E. W., Jones, M. T., Tierney, J. E., Svensen, H. H., & Whiteside, J. H. (2020). Temperature changes across the Paleocene-Eocene Thermal Maximum–a new high-resolution TEX86 temperature record from the Eastern North Sea Basin. Earth and Planetary Science Letters, 544, 116388.
-"Earth in the Future" course at Penn State (https://www.e-education.psu.edu/earth103/node/639)



