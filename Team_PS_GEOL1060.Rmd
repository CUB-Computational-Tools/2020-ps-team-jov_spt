---
title: "Ocean Acidification Problem Set"
author: "Juliana Olsen-Valdez & Stephanie Plaza-Torres"
date: "Last knitted `r format(Sys.Date(), '%d %b %Y')`"
output:
  html_document: 
    df_print: paged
    number_sections: yes
    toc: yes
    toc_float: true
    toc_depth: 3
    code_folding: show
editor_options:
  chunk_output_type: inline
---

> Click into a code cell (the gray blocks below) to select or edit it. To run a selected code cell, hit `Ctrl`+`Shift`+`Enter` (Windows & Linux) / `Command`+`Shift`+`Enter` (MacOS). Make sure that each code cell runs successfully before you move on to the next one. There is also a small green 'play' button in the corner that wil run the code cell for you.

<p>&nbsp;</p>
# ***Ocean Acidification***
<p>&nbsp;</p>

## Using Data Sets 

> We'll first load some R packages that will allow us to make our code do things like pull in data sets from a folder or make a plot. *R packages* are collections of functions and data sets developed by the community. They improve the existing base fuctionalities of R and expand what you can achieve with your code. 
But what is a function?

> A *function* is a conjunction of code that achieves a specific task. This code can be 'called' using the function's given name. What the function ultimately does is take in data and return a result based on that function's 'inner' code. 

```{r load packages}
# The library() function loads each package. You need to do this so R can find the functions you need from a certain package. Once the package loads all the different functions associated with it are usable. 
library(tidyverse) #these are all different libraries that help the code do different things
library(readxl)#the blue "library" part tells R that this is a package it should load and the black writing is the name of the specific package(in this case "readxl" which helps us read Excel files into R)
library(cowplot)
library(ggplot2)#this library, for example, helps us make plots of our data. 
#notice that because there is a "#" symbol before all of the note text above, it's all just comments that don't affect the code!
```

### Modern $CO_2$ Concentration

At Mauna Loa, NOAA has data looking at the monthly avergae of the parts per million concentration of $CO_2$ since the 1980s. We will plot this data to see what the trends for $CO_2$ have been in the past 40 years.

First, let's import the Mauna Loa data:
```{r load Mauna Loa data}
MaunaLoa_data <-  read_excel("data/co2_monthly_average.xlsx") #here we are reading an excel file that contains our monthly average CO2 data (in ppm) from Mauna Loa. Since our data is in a table, the file will import itself as a data frame called MaunaLoa_data (this is a variable).
#a data frame in R is a table or a two-dimensional array-like structure in which each column contains values of one variable and each row contains one set of values from each column. 

MaunaLoa_data #this will print out our data frame for us to see and make sure it looks alright. You can see columns year, month, decimal, average, trend. 
#year tells us the year we are in 
#month tells the month of a particular year 
#decimal is the year with a decimal place that represents the month of that year in which you are
#average shows the monthly mean CO2 ppm values, centered on the middle of each month 
#trend represents the same as average, after correction for the average seasonal cycle


```

Next, let's have you assign a variable in a similar fashion in which we added the Excel data to `MaunaLoa_data`. In this next code chunk, write "parts per million (ppm)" after the `<-` arrow besides our ML_y_title variable. What we are doing here is setting up the y axis title for our plot for the Mauna Loa data.

```{r assign y axis title to a variable}
ML_y_title <- "parts per million (ppm)"
```

Congrats! You've assigned a variable. Now let's put it to use in our Mauna Loa plot.

We will use the decimal column for our x axis and the average column for our y. We are using decimal instead of the year or month column so we can see the progression of concentration data through each yea rand the next. 

*What do you think would happen if we use the year or month columns for our plot?*

Answer here: 

```{r plot Mauna Loa data}
ML_CO2vsYear <- #We create a new plot stored in "ML_CO2vsYear"
ggplot(MaunaLoa_data, aes(x = decimal, y = average)) + #we call the function ggplot to input our data set and assign x and y variables
geom_line(size = 0.5, color = 'black')+ #We define a black line to connect our data points
labs(y = ML_y_title, x = "Year", title = bquote("Atmospheric" ~ CO[2] ~ "at Mauna Loa Observatory")) + #We give our graph labels
theme_bw() #We make the background grid theme/color black and white 

ML_CO2vsYear #prints out our plot
```
We can see a general upwards trend in $CO_2$ concentration. This is due to anthropogenic influence in emissions. Since there is so much fossil fuel consumption, $CO_2$ has increased steadily through the years. In this [link](https://www.esrl.noaa.gov/gmd/ccgg/trends/ff.html) you will see and animation showing the contributions of fossil fuel consumption to atmospheric $CO_2$.

I imagine you have already noticed that the monthly average concentrations of our plot fluctuate up and down.

*Why do you think this causes this?*

Answer here: 


```{r plot Mauna Loa data with trend}
ML_CO2vsYear_wTrend <- #We create a new plot stored in "ML_CO2vsYear_wTrend"
ggplot() + #we call the function ggplot to input our data set and assign x and y variables
geom_line(data = MaunaLoa_data, aes(x = decimal, y = average), size = 0.5, color = 'black')+ #We define a black line to connect our data points 
geom_line(data = MaunaLoa_data, aes(x = decimal, y = trend), size = 0.5, color = 'red')+ #We add our trend column data in red 
labs(y = ML_y_title, x = "Year", title = bquote("Atmospheric" ~ CO[2] ~ "at Mauna Loa Observatory")) + #We give our graph labels
theme_bw() #We make the background grid theme/color black and white 

ML_CO2vsYear_wTrend #prints out our plot
```
If we plot the trend column from our `MaunaLoa_data` (seen here as the red line) we can see the monthly ppm average but corrected for the seasonal cycles (ups and downs) you noticed before.

### Modern Sea Surface Temperature

Now let's look at what has been happening to the sea surface temperature given the increasing $CO_2$ concentrations.

Remember that $CO_2$ is a greenhouse gas, which can trap the heat originated from the Earth’s surface.  If there is more $CO_2$ then more heat gets trapped, and if there is less $CO_2$ then less heat gets trapped.  This affects the average temperature of the planet, including seas surface temperature (SST).

Let's load our NOAA SST data and plot it.

```{r load modern SST data}
ModernSST_data <- read_excel("data/EPA_SST.xlsx") 
names(ModernSST_data) <- c("year", "anomaly", "lower_95", "higher_95")

fahr_to_cel <- function(temp) {
  cel <- (temp - 32) * (5 / 9)
  return(cel)
}

ModernSST_data$anomaly <- fahr_to_cel(ModernSST_data$anomaly)
ModernSST_data$lower_95 <- fahr_to_cel(ModernSST_data$lower_95)
ModernSST_data$higher_95 <- fahr_to_cel(ModernSST_data$higher_95)

```

```{r plot modern SST data}
SSTvsYear <-
ggplot(ModernSST_data, aes(x = year, y = anomaly)) + 
geom_line(size = 0.5, color = 'black') + 
geom_ribbon(aes(ymin = lower_95, ymax = higher_95), linetype = 2, alpha = 0.3) +
geom_hline(yintercept = -17.7778, linetype = "dashed", color = "maroon") +
labs(y = "Temperature Anomaly (degrees F) ", x = "Year", title = "Average Global Sea Surface Temperature, 1880–2015") + 
theme_bw()  


#geom_ribbon(aes(ymin=data$lower, ymax=data$upper), linetype=2, alpha=0.1)
SSTvsYear #prints out our plot
```

In the graph above we have plotted the average surface temperature change (respect to a 1971 to 2000 average as baseline - shown as dahsed line) of the world’s oceans since 1880. Choosing a different baseline period would not change the shape of the data over time. The gray shade shows the uncertainty of the data, based on the methods used to get the average temperatures and the amount of measurements.

### Comparing the trends in $CO_2$ and SST

Now let's compare the trends our $CO_2$ and SST plots. 

```{r plot modern SST data since 1980}
new_ModernSST_data <- subset(ModernSST_data, year >= 1980)

newSSTvsYear <-
ggplot(new_ModernSST_data, aes(x = year, y = anomaly)) + 
geom_line(size = 0.5, color = 'black') + 
geom_ribbon(aes(ymin = lower_95, ymax = higher_95), linetype = 2, alpha = 0.3) +
geom_hline(yintercept = -17.7778, linetype = "dashed", color = "maroon") +
labs(y = "Temperature Anomaly (degrees F) ", x = "Year", title = "Average Global Sea Surface Temperature, 1980–2015") + 
theme_bw()  

```
```{r plot CO2 and SST side by side}
modern_sideBYside <- plot_grid(ML_CO2vsYear_wTrend, newSSTvsYear, ncol = 2, nrow = 1)

modern_sideBYside
```
<p>&nbsp;</p>
*Do you see a relationship between $CO_2$ and SST? If so, why?*

Answer here: 


### Paleocene-Eocene Thermal Maximum Sea Surface Temperature

Now, we'll load PETM data of estimated SST (degrees Celsius):
```{r load PETM data}
PETM_data <- #we are making a new data set called "PETM_data" 
  read_excel("data/FAKE_PETM_SST_data.xlsx") #we are reading in the excel file with our data (which is in the data folder)
```

Plot the estimated SST (degrees Celsius) data over time:
```{r plot PETM data}
SSTvAge <- #We create a new plot that's named "SSTvAge"
ggplot(PETM_data, aes(x = Age, y = SST)) + #we call the function ggplot to input our data set and assign x and y variables
geom_line(size = 0.5, color = 'red')+ #We define a red line to connect our data points
labs(y = "SST (degrees C)", x = "Age (Ma)", title = "SST (degrees Celcius) vs Age (Ma) during the PETM from Stokke et al. (2020)" )+ #We give our graph labels
theme_bw() #We make the background grid theme/color black and white 
SSTvAge
```

```{r PETM vs Modern SST}
PETM_vs_modern <- plot_grid(SSTvAge, SSTvsYear, ncol = 2, nrow = 1)
```


# Sources: 
- McInerney, F. A., & Wing, S. L. (2011). The Paleocene-Eocene Thermal Maximum: a perturbation of carbon cycle, climate, and biosphere with implications for the future. Annual Review of Earth and Planetary Sciences, 39, 489-516.
- NOAA Global Monitoring Laboratory, Mauna Loa
- NOAA Extended Reconstructed Sea Surface Temperature (ERSST)
- PETM data modified from Stokke, E. W., Jones, M. T., Tierney, J. E., Svensen, H. H., & Whiteside, J. H. (2020). Temperature changes across the Paleocene-Eocene Thermal Maximum–a new high-resolution TEX86 temperature record from the Eastern North Sea Basin. Earth and Planetary Science Letters, 544, 116388.



